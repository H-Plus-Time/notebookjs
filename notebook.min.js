// notebook.js 0.0.1
// http://github.com/jsvine/notebookjs
// (c) 2014 Jeremy Singer-Vine
// notebook.js may be freely distributed under the MIT license.
((function(){var a=this,b="0.0.1",c=a.document||require("jsdom").jsdom(),d=function(a){return a},e=function(a,b){var d=c.createElement(a);return d.className=(b||[]).map(function(a){return j.prefix+a}).join(" "),d},f=function(a){var b=a.replace(/</g,"&lt;").replace(/>/g,"&gt;");return b},g=function(a){return typeof require=="function"&&require(a)},h=function(){return a.marked||g("marked")},i=function(){var b=g("ansi_up"),c=a.ansi_up||b;return c&&c.ansi_to_html},j={prefix:"nb-",markdown:h()||d,ansi:i()||d,VERSION:b};j.Input=function(a,b){this.raw=a,this.cell=b},j.Input.prototype.render=function(){if(!this.raw.length)return e("div");var a=e("div",["input"]),b=this.cell.raw.prompt_number;b&&a.setAttribute("data-prompt-number",b);var c=e("pre"),d=e("code"),g=this.cell.worksheet.notebook,h=g.metadata.language||this.cell.raw.language;return d.setAttribute("data-language",h),d.className="lang-"+h,d.innerHTML=f(this.raw.join("")),c.appendChild(d),a.appendChild(c),this.el=a,a};var k=function(a){return function(b){var c=e("img",["image-output"]);return c.src="data:image/"+a+";base64,"+b.replace(/\n/g,""),c}};j.display={},j.display.text=function(a){var b=e("pre",["text-output"]);return b.innerHTML=f(a.join("")),b},j.display.html=function(a){var b=e("div",["html-output"]);return b.innerHTML=a.join(""),b},j.display.svg=function(a){var b=e("div",["svg-output"]);return b.innerHTML=a.join(""),b},j.display.latex=function(a){var b=e("div",["latex-output"]);return b.innerHTML=a.join(""),b},j.display.javascript=function(a){var b=e("script");return script.innerHTML=a,b},j.display.png=k("png"),j.display.jpeg=k("jpeg"),j.display_priority=["png","jpeg","svg","html","latex","javascript","text"];var l=function(){var a=this,b=j.display_priority.filter(function(b){return a.raw[b]}),c=b[0];return c?j.display[c](a.raw[c]):e("div",["empty-output"])};j.Output=function(a,b){this.raw=a,this.cell=b,this.type=a.output_type},j.Output.prototype.renderers={display_data:l,pyout:l,pyerr:function(){var a=e("pre",["pyerr"]);return a.innerHTML=j.ansi(this.raw.traceback.join("")),a},stream:function(){var a=e("pre",[this.raw.stream]),b=this.raw.text.join("");return a.innerHTML=j.ansi(b),a}},j.Output.prototype.render=function(){var a=e("div",["output"]),b=this.cell.raw.prompt_number;b&&a.setAttribute("data-prompt-number",b);var c=this.renderers[this.type].call(this);return a.appendChild(c),this.el=a,a},j.coalesceStreams=function(a){if(!a.length)return a;var b=a[0],c=[b];return a.slice(1).forEach(function(a){a.raw.output_type==="stream"&&b.raw.output_type==="stream"&&a.raw.stream===b.raw.stream?b.raw.text=b.raw.text.concat(a.raw.text):(c.push(a),b=a)}),c},j.Cell=function(a,b){var c=this;c.raw=a,c.worksheet=b,c.type=a.cell_type;if(c.type==="code"){c.input=new j.Input(c.raw.input,c);var d=(c.raw.outputs||[]).map(function(a){return new j.Output(a,c)});c.outputs=j.coalesceStreams(d)}},j.Cell.prototype.renderers={markdown:function(){var a=e("div",["cell","markdown-cell"]);return a.innerHTML=j.markdown(this.raw.source.join("")),a},heading:function(){var a=e("h"+this.raw.level,["cell","heading-cell"]);return a.innerHTML=this.raw.source.join(""),a},code:function(){var a=e("div",["cell","code-cell"]);a.appendChild(this.input.render());var b=this.outputs.forEach(function(b){a.appendChild(b.render())});return a}},j.Cell.prototype.render=function(){var a=this.renderers[this.type].call(this);return this.el=a,a},j.Worksheet=function(a,b){var c=this;this.raw=a,this.notebook=b,this.cells=a.cells.map(function(a){return new j.Cell(a,c)}),this.render=function(){var a=e("div",["worksheet"]);return c.cells.forEach(function(b){a.appendChild(b.render())}),this.el=a,a}},j.Notebook=function(a,b){var c=this;this.raw=a,this.config=b;var d=this.metadata=a.metadata;this.title=d.title||d.name,this.worksheets=a.worksheets.map(function(a){return new j.Worksheet(a,c)}),this.sheet=this.worksheets[0]},j.Notebook.prototype.render=function(){var a=e("div",["notebook"]);return this.worksheets.forEach(function(b){a.appendChild(b.render())}),this.el=a,a},j.parse=function(a,b){return new j.Notebook(a,b)},typeof define=="function"&&define.amd&&define(function(){return j}),typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=j),exports.nb=j):a.nb=j})).call(this);